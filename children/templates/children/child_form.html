{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block title %}{{ title }} - {% trans "Les Bons P'tits Loups" %}{% endblock %}

{% block content %}
<div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6 sm:p-8">
    <h2 class="text-xl sm:text-2xl font-bold text-center mb-6 text-gray-800">{{ title }}</h2>
    <form method="post" class="space-y-4">
        {% csrf_token %}
        {{ form|crispy }}
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-4">
            <button type="submit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition duration-200 text-sm sm:text-base">
                {% trans "Enregistrer" %}
            </button>
            <a href="{% url 'children:dashboard' %}" class="flex-1 bg-gray-500 text-white py-2 px-4 rounded hover:bg-gray-600 transition duration-200 text-center text-sm sm:text-base">
                {% trans "Annuler" %}
            </a>
        </div>
    </form>
</div>

<script>
// Fix for Firefox mobile: ensure date input value is properly formatted
document.addEventListener('DOMContentLoaded', function() {
    const dateInput = document.querySelector('input[type="date"][name="birth_date"]');
    if (dateInput && dateInput.value) {
        // Ensure the date is in YYYY-MM-DD format
        const dateValue = dateInput.value;
        // Check if it's already in YYYY-MM-DD format
        const datePattern = /^\d{4}-\d{2}-\d{2}$/;
        if (!datePattern.test(dateValue)) {
            // Try to parse and reformat
            const date = new Date(dateValue);
            if (!isNaN(date.getTime())) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                dateInput.value = `${year}-${month}-${day}`;
            }
        }
        // Force Firefox to recognize the value by setting it again
        const currentValue = dateInput.value;
        dateInput.value = '';
        // Use setTimeout to ensure the value is set after the field is ready
        setTimeout(function() {
            dateInput.value = currentValue;
        }, 100);
    }
});
</script>
{% endblock %}

